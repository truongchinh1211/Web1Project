
// let productsDB = 
// [
//     new product ("1",
//     "iPhone 13 Pro Max 128GB",
//     "28.490.000",
//     100,
//     "./asset/img/product/iphone-13-pro-max-xanh-la-thumb-1-600x600.jpg",
//     "1",
//     `Chip Apple A15 Bionic

//     RAM: 6 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: 3 camera 12 MP
    
//     Camera trước: 12 MP
    
//     Pin 4352 mAh, Sạc 20 W`),
//     new product ("2",
//     "Vivo V23e",
//     "7.690.000",
//     100,
//     "./asset/img/product/vivo-v23e-1-600x600.jpg",
//     "2",
//     `Chip Snapdragon 8 Gen 1

//     RAM: 8 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 50 MP & Phụ 12 MP, 10 MP
    
//     Camera trước: 10 MP
    
//     Pin 4500 mAh, Sạc 45 W`),
//     new product ("3",
//     "Samsung Galaxy S21 FE 5G",
//     "19.490.000",
//     100,
//     "./asset/img/product/samsung-galaxy-s21-fe-256gb-040122-111429-600x600.jpg",
//     "3",
//     `Chip Exynos 2100

//     RAM: 8 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 12 MP & Phụ 12 MP, 8 MP
    
//     Camera trước: 32 MP
    
//     Pin 4500 mAh, Sạc 25 W`),
//     new product ("4",
//     "Samsung Galaxy Z Flip4",
//     "20.990.000",
//     100,
//     "./asset/img/product/samsung-galaxy-z-flip4-5g.jpg",
//     "3",
//     `Chip Snapdragon 8+ Gen 1

//     RAM: 8 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: 2 camera 12 MP
    
//     Camera trước: 10 MP
    
//     Pin 3700 mAh, Sạc 25 W`),
//     new product ("5",
//     "Samsung Galaxy S22 Ultra",
//     "25.990.000",
//     100,
//     "./asset/img/product/samsung-galaxy-s22-ultra-.jpg",
//     "3",
//     `Chip Snapdragon 8 Gen 1

//     RAM: 8 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 108 MP & Phụ 12 MP, 10 MP, 10 MP
    
//     Camera trước: 40 MP
    
//     Pin 5000 mAh, Sạc 45 W`),
//     new product ("6",
//     "Samsung Galaxy A23",
//     "5.490.000",
//     100,
//     "./asset/img/product/samsung-galaxy-a23.jpg",
//     "3",
//     `- Chip Snapdragon 680

//     RAM: 4 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 50 MP & Phụ 5 MP, 2 MP, 2 MP
    
//     Camera trước: 8 MP
    
//     Pin 5000 mAh, Sạc 25 W`),
//     new product ("7",
//     "Samsung Galaxy A73",
//     "11.690.000",
//     100,
//     "./asset/img/product/samsung-galaxy-a73.jpg",
//     "3",
//     `Chip Snapdragon 778G 5G

//     RAM: 8 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 108 MP & Phụ 12 MP, 5 MP, 5 MP
    
//     Camera trước: 32 MP
    
//     Pin 5000 mAh, Sạc 25 W`),
//     new product ("8",
//     "Samsung Galaxy M53",
//     "11.100.000",
//     100,
//     "./asset/img/product/samsung-galaxy-m53.jpg",
//     "3",
//     `Chip MediaTek Dimensity 900 5G

//     RAM: 8 GB
    
//     Dung lượng: 256 GB
    
//     Camera sau: Chính 108 MP & Phụ 8 MP, 2 MP, 2 MP
    
//     Camera trước: 32 MP
    
//     Pin 5000 mAh, Sạc 25 W`),
//     new product ("9",
//     "Samsung Galaxy A53",
//     "9.690.000",
//     100,
//     "./asset/img/product/samsung-galaxy-a53.jpg",
//     "3",
//     `Chip Exynos 1280

//     RAM: 8 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 64 MP & Phụ 12 MP, 5 MP, 5 MP
    
//     Camera trước: 32 MP
    
//     Pin 5000 mAh, Sạc 25 W`),
//     new product ("10",
//     "Samsung Galaxy A33",
//     "7.290.000",
//     100,
//     "./asset/img/product/samsung-galaxy-a33.jpg",
//     "3",
//     `Chip Exynos 1280

//     RAM: 6 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 48 MP & Phụ 8 MP, 5 MP, 2 MP
    
//     Camera trước: 13 MP
    
//     Pin 5000 mAh, Sạc 25 W`),
//     new product ("11",
//     "Samsung Galaxy A32",
//     "6.490.000",
//     100,
//     "./asset/img/product/samsung-galaxy-a32.jpg",
//     "3",
//     `Chip MediaTek Helio G80

//     RAM: 6 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 64 MP & Phụ 8 MP, 5 MP, 5 MP
    
//     Camera trước: 20 MP
    
//     Pin 5000 mAh, Sạc 15 W`),
//     new product ("12",
//     "Samsung Galaxy A22",
//     "5.890.000",
//     100,
//     "./asset/img/product/samsung-galaxy-a22.jpg",
//     "3",
//     `Chip MediaTek MT6769V (Helio G80)

//     RAM: 6 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 48 MP & Phụ 8 MP, 2 MP, 2 MP
    
//     Camera trước: 13 MP
    
//     Pin 5000 mAh, Sạc 15 W`),
//     new product ("13",
//     "Samsung Galaxy A13",
//     "4.290.000",
//     100,
//     "./asset/img/product/samsung-galaxy-a13.jpg",
//     "3",
//     `Chip Exynos 850

//     RAM: 4 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 50 MP & Phụ 5 MP, 2 MP, 2 MP
    
//     Camera trước: 8 MP
    
//     Pin 5000 mAh, Sạc 15 W`),
//     new product ("14",
//     "OPPO Reno8 series",
//     "18.990.000",
//     100,
//     "./asset/img/product/oppo-reno8.jpg",
//     "4",
//     `Chip MediaTek Dimensity 8100 Max 8 nhân

//     RAM: 12 GB
    
//     Dung lượng: 256 GB
    
//     Camera sau: Chính 50 MP & Phụ 8 MP, 2 MP
    
//     Camera trước: 32 MP
    
//     Pin 4500 mAh, Sạc 80 W`),
//     new product ("15",
//     "OPPO A55",
//     "4.190.000",
//     100,
//     "./asset/img/product/oppo-a55.jpg",
//     "4",
//     `Chip MediaTek Helio G35

//     RAM: 4 GB
    
//     Dung lượng: 64 GB
    
//     Camera sau: Chính 50 MP & Phụ 2 MP, 2 MP
    
//     Camera trước: 16 MP
    
//     Pin 5000 mAh, Sạc 18 W`),
//     new product ("16",
//     "OPPO Find X5 Pro",
//     "30.490.000",
//     100,
//     "./asset/img/product/oppo-find-x5-pro.jpg",
//     "4",
//     `Chip Snapdragon 8 Gen 1

//     RAM: 12 GB
    
//     Dung lượng: 256 GB
    
//     Camera sau: Chính 50 MP & Phụ 50 MP, 13 MP
    
//     Camera trước: 32 MP
    
//     Pin 5000 mAh, Sạc 80 W`),
//     new product ("17",
//     "OPPO Reno6 series",
//     "10.890.000",
//     100,
//     "./asset/img/product/oppo-reno6.jpg",
//     "4",
//     `Chip MediaTek Dimensity 900 5G

//     RAM: 8 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 64 MP & Phụ 8 MP, 2 MP
    
//     Camera trước: 32 MP
    
//     Pin 4300 mAh, Sạc 65 W`),
//     new product ("18",
//     "OPPO Reno7 series",
//     "9.590.000",
//     100,
//     "./asset/img/product/oppo-reno7.jpg",
//     "4",
//     `Chip Snapdragon 695 5G

//     RAM: 8 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 64 MP & Phụ 2 MP, 2 MP
    
//     Camera trước: 16 MP
    
//     Pin 4500 mAh, Sạc 33 W`),
//     new product ("19",
//     "OPPO A96",
//     "6.690.000",
//     100,
//     "./asset/img/product/oppo-a96.jpg",
//     "4",
//     `Chip Snapdragon 680

//     RAM: 8 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 50 MP & Phụ 2 MP
    
//     Camera trước: 16 MP
    
//     Pin 5000 mAh, Sạc 33 W`),
//     new product ("20",
//     "OPPO A95",
//     "6.090.000",
//     100,
//     "./asset/img/product/oppo-a95.jpg",
//     "4",
//     `Chip Snapdragon 662

//     RAM: 8 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 48 MP & Phụ 2 MP, 2 MP
    
//     Camera trước: 16 MP
    
//     Pin 5000 mAh, Sạc 33 W`),
//     new product ("21",
//     "OPPO A76",
//     "5.690.000",
//     100,
//     "./asset/img/product/oppo-a76.jpg",
//     "4",
//     `Chip Snapdragon 680

//     RAM: 6 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 13 MP & Phụ 2 MP
    
//     Camera trước: 8 MP
    
//     Pin 5000 mAh, Sạc 33 W`),
//     new product ("22",
//     "OPPO A57",
//     "4.190.000",
//     100,
//     "./asset/img/product/oppo-a57.jpg",
//     "4",
//     `Chip MediaTek Helio G35

//     RAM: 4 GB
    
//     Dung lượng: 64 GB
    
//     Camera sau: Chính 13 MP & Phụ 2 MP
    
//     Camera trước: 8 MP
    
//     Pin 5000 mAh, Sạc 33 W`),
//     new product ("23",
//     "OPPO A17",
//     "3.990.000",
//     100,
//     "./asset/img/product/oppo-a17.jpg",
//     "4",
//     `Chip MediaTek Helio G35

//     RAM: 4 GB
    
//     Dung lượng: 64 GB
    
//     Camera sau: Chính 50 MP & Phụ 0.3 MP
    
//     Camera trước: 5 MP
    
//     Pin 5000 mAh, Sạc 10 W`),
//     new product ("24",
//     "Vivo V25 series",
//     "10.490.000",
//     100,
//     "./asset/img/product/vivo-v25.jpg",
//     "2",
//     `Chip MediaTek Dimensity 900 5G

//     RAM: 8 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 64 MP & Phụ 8 MP, 2 MP
    
//     Camera trước: 50 MP
    
//     Pin 4500 mAh, Sạc 44 W`),
//     new product ("25",
//     "Vivo T1 series",
//     "8.490.000",
//     100,
//     "./asset/img/product/vivo-t1.jpg",
//     "2",
//     `Chip Snapdragon 778G 5G

//     RAM: 8 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 64 MP & Phụ 8 MP, 2 MP
    
//     Camera trước: 16 MP
    
//     Pin 4700 mAh, Sạc 66 W`),
//     new product ("26",
//     "Vivo V25 Pro",
//     "13.990.000",
//     100,
//     "./asset/img/product/vivo-v25-pro.jpg",
//     "2",
//     `Chip MediaTek Dimensity 1300

//     RAM: 8 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 64 MP & Phụ 8 MP, 2 MP
    
//     Camera trước: 32 MP
    
//     Pin 4830 mAh, Sạc 66 W`),
//     new product ("27",
//     "Vivo X80",
//     "19.190.000",
//     100,
//     "./asset/img/product/vivo-x80.jpg",
//     "2",
//     `Chip MediaTek Dimensity 9000

//     RAM: 12 GB
    
//     Dung lượng: 256 GB
    
//     Camera sau: Chính 50 MP & Phụ 12 MP, 12 MP
    
//     Camera trước: 32 MP
    
//     Pin 4500 mAh, Sạc 80 W`),
//     new product ("28",
//     "Vivo Y35",
//     "6.990.000",
//     100,
//     "./asset/img/product/vivo-y35.jpg",
//     "2",
//     `Chip Snapdragon 680

//     RAM: 8 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 50 MP & Phụ 2 MP, 2 MP
    
//     Camera trước: 16 MP
    
//     Pin 5000 mAh, Sạc 44 W`),
//     new product ("29",
//     "Vivo Y53s",
//     "6.990.000",
//     100,
//     "./asset/img/product/vivo-y53s.jpg",
//     "2",
//     `Chip MediaTek Helio G80

//     RAM: 8 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 64 MP & Phụ 2 MP, 2 MP
    
//     Camera trước: 16 MP
    
//     Pin 5000 mAh, Sạc 33 W`),
//     new product ("30",
//     "Vivo Y55",
//     "6.790.000",
//     100,
//     "./asset/img/product/vivo-y55.jpg",
//     "2",
//     `Chip Snapdragon 680

//     RAM: 8 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 50 MP & Phụ 2 MP, 2 MP
    
//     Camera trước: 16 MP
    
//     Pin 5000 mAh, Sạc 44 W`),
//     new product ("31",
//     "Vivo Y33s",
//     "6.290.000",
//     100,
//     "./asset/img/product/vivo-y33s.jpg",
//     "2",
//     `Chip MediaTek Helio G80

//     RAM: 8 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 50 MP & Phụ 2 MP, 2 MP
    
//     Camera trước: 16 MP
    
//     Pin 5000 mAh, Sạc 18 W`),
//     new product ("32",
//     "Vivo Y22s",
//     "5.290.000",
//     100,
//     "./asset/img/product/vivo-y22s.jpg",
//     "2",
//     `Chip Snapdragon 680

//     RAM: 4 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 50 MP & Phụ 2 MP
    
//     Camera trước: 8 MP
    
//     Pin 5000 mAh, Sạc 18 W`),
//     new product ("33",
//     "iPhone 11",
//     "11.990.000",
//     100,
//     "./asset/img/product/iphone-xi.jpg",
//     "1",
//     `Chip Apple A13 Bionic

//     RAM: 4 GB
    
//     Dung lượng: 64 GB
    
//     Camera sau: 2 camera 12 MP
    
//     Camera trước: 12 MP
    
//     Pin 3110 mAh, Sạc 18 W`),
//     new product ("34",
//     "iPhone 14 Pro Max",
//     "33.990.000",
//     100,
//     "./asset/img/product/iphone-14-pro-max.jpg",
//     "1",
//     `Chip Apple A16 Bionic

//     RAM: 6 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 48 MP & Phụ 12 MP, 12 MP
    
//     Camera trước: 12 MP
    
//     Pin 4323 mAh, Sạc 20 W`),
//     new product ("35",
//     "iPhone 13 Pro",
//     "25.990.000",
//     100,
//     "./asset/img/product/iphone-13-pro.jpg",
//     "1",
//     `Chip Apple A15 Bionic

//     RAM: 6 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: 3 camera 12 MP
    
//     Camera trước: 12 MP
    
//     Pin 3095 mAh, Sạc 20 W`),
//     new product ("36",
//     "iPhone 14 Plus",
//     "25.790.000",
//     100,
//     "./asset/img/product/iPhone-14Plus.jpg",
//     "1",
//     `Chip Apple A15 Bionic

//     RAM: 6 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: 2 camera 12 MP
    
//     Camera trước: 12 MP
    
//     Pin 4325 mAh, Sạc 20 W`),
//     new product ("37",
//     "iPhone 12",
//     "16.990.000",
//     100,
//     "./asset/img/product/iphone-12.jpg",
//     "1",
//     `Chip Apple A14 Bionic

//     RAM: 4 GB
    
//     Dung lượng: 64 GB
    
//     Camera sau: 2 camera 12 MP
    
//     Camera trước: 12 MP
    
//     Pin 2815 mAh, Sạc 20 W`),
//     new product ("38",
//     "iPhone SE 64GB",
//     "11.490.000",
//     100,
//     "./asset/img/product/iphone-se.jpg",
//     "1",
//     `Chip Apple A15 Bionic

//     RAM: 4 GB
    
//     Dung lượng: 64 GB
    
//     Camera sau: 12 MP
    
//     Camera trước: 7 MP
    
//     Pin 2018 mAh, Sạc 20 W`),
//     new product ("39",
//     "iPhone 14",
//     "22.790.000",
//     100,
//     "./asset/img/product/iPhone-14.jpg",
//     "1",
//     `Chip Apple A15 Bionic

//     RAM: 6 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: 2 camera 12 MP
    
//     Camera trước: 12 MP
    
//     Pin 3279 mAh, Sạc 20 W`),
//     new product ("40",
//     "Xiaomi 12T Pro",
//     "16.990.000",
//     100,
//     "./asset/img/product/xiaomi-12t-pro.jpeg",
//     "5",
//     `Chip Snapdragon 8+ Gen 1

//     RAM: 12 GB
    
//     Dung lượng: 256 GB
    
//     Camera sau: Chính 200 MP & Phụ 8 MP, 2 MP
    
//     Camera trước: 20 MP
    
//     Pin 5000 mAh, Sạc 120 W`),
//     new product ("41",
//     "Xiaomi Redmi Note 11S",
//     "6.490.000",
//     100,
//     "./asset/img/product/xiaomi-redmi-note-11s.jpg",
//     "5",
//     `Chip MediaTek Dimensity 810 5G

//     RAM: 6 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 50 MP & Phụ 8 MP, 2 MP
    
//     Camera trước: 13 MP
    
//     Pin 5000 mAh, Sạc 33 W`),
//     new product ("42",
//     "Xiaomi 12 series",
//     "16.490.000",
//     100,
//     "./asset/img/product/Xiaomi-12.jpg",
//     "5",
//     `Chip Snapdragon 8 Gen 1

//     RAM: 8 GB
    
//     Dung lượng: 256 GB
    
//     Camera sau: Chính 50 MP & Phụ 13 MP, 5 MP
    
//     Camera trước: 32 MP
    
//     Pin 4500 mAh, Sạc 67 W`),
//     new product ("43",
//     "Xiaomi 11T Pro",
//     "13.990.000",
//     100,
//     "./asset/img/product/xiaomi-11t-pro.jpeg",
//     "5",
//     `Chip Snapdragon 888

//     RAM: 8 GB
    
//     Dung lượng: 256 GB
    
//     Camera sau: Chính 108 MP & Phụ 8 MP, 5 MP
    
//     Camera trước: 16 MP
    
//     Pin 5000 mAh, Sạc 120 W`),
//     new product ("44",
//     "Xiaomi 11T",
//     "10.390.000",
//     100,
//     "./asset/img/product/xiaomi-11t.jpg",
//     "5",
//     `Chip MediaTek Dimensity 1200

//     RAM: 8 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 108 MP & Phụ 8 MP, 5 MP
    
//     Camera trước: 16 MP
    
//     Pin 5000 mAh, Sạc 67 W`),
//     new product ("45",
//     "Xiaomi 11 Lite",
//     "8.890.000",
//     100,
//     "./asset/img/product/xiaomi-11-lite.jpg",
//     "5",
//     `Chip Snapdragon 778G 5G

//     RAM: 8 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 64 MP & Phụ 8 MP, 5 MP
    
//     Camera trước: 20 MP
    
//     Pin 4250 mAh, Sạc 33 W`),
//     new product ("46",
//     "Xiaomi Redmi Note 11 Pro",
//     "7.190.000",
//     100,
//     "./asset/img/product/xiaomi-redmi-note-11-pro.jpg",
//     "5",
//     `Chip MediaTek Helio G96

//     RAM: 8 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 108 MP & Phụ 8 MP, 2 MP, 2 MP
    
//     Camera trước: 16 MP
    
//     Pin 5000 mAh, Sạc 67 W`),
//     new product ("47",
//     "Xiaomi Redmi Note 10 Pro",
//     "7.090.000",
//     100,
//     "./asset/img/product/xiaomi-redmi-note-10-pro.jpg",
//     "5",
//     `Chip Snapdragon 732G

//     RAM: 8 GB
    
//     Dung lượng: 128 GB
    
//     Camera sau: Chính 108 MP & Phụ 8 MP, 5 MP, 2 MP
    
//     Camera trước: 16 MP
    
//     Pin 5020 mAh, Sạc 33 W`),
//     new product ("48",
//     "Xiaomi Redmi 10C",
//     "3.490.000",
//     100,
//     "./asset/img/product/xiaomi-redmi-10c.jpg",
//     "5",
//     `Chip Snapdragon 680

//     RAM: 4 GB
    
//     Dung lượng: 64 GB
    
//     Camera sau: Chính 50 MP & Phụ 2 MP
    
//     Camera trước: 5 MP
    
//     Pin 5000 mAh, Sạc 18 W`),
//     new product ("49",
//     "POCO C40",
//     "2.990.000",
//     100,
//     "./asset/img/product/xiaomi-poco.jpg",
//     "5",
//     `Chip JLQ JR510

//     RAM: 4 GB
    
//     Dung lượng: 64 GB
    
//     Camera sau: Chính 13 MP & Phụ 2 MP
    
//     Camera trước: 5 MP
    
//     Pin 6000 mAh, Sạc 18 W`),

// ]


// =================================================== //
// ---------------- Variables creating --------------- //
// =================================================== //
// localStorage.setItem("products",JSON.stringify(productsDB));


function product(id, name, price, quantity ,background_image, categoryID, description) {
    this.id = id,
    this.name = name;
    this.price = price + " đ";
    this.quantity = quantity;
    this.background_image = background_image;
    this.categoryID = categoryID;
    this.description = description;
}

function cart_product (id, img, name, price, quantity) {
    this.id = id,
    this.img = img;
    this.name = name;
    this.price = price;
    this.quantity = quantity;
    this.totalPrice = this.quantity*this.price;
}

function category(categoryID, categoryName, categoryImg) {
    this.categoryID = categoryID;
    this.categoryName = categoryName;
    this.categoryImg = categoryImg;
}

// categoriesDB = [
//     new category("1","iphone","asset/logo/logo-iphone-220x48.png"),
//     new category("2","Vivo","/asset/logo/vivo-logo-220-220x48-3.png"),
//     new category("3","Samsung","/asset/logo/samsungnew-220x48-1.png"),
//     new category("4","Oppo","/asset/logo/OPPO42-b_5.jpg"),
//     new category("5","Xiaomi","/asset/logo/logo-xiaomi-220x48-5.png")
// ]
// localStorage.setItem("categories", JSON.stringify(categoriesDB));


let orderList = localStorage.getItem("orderList") ? JSON.parse(localStorage.getItem("orderList")) : [];
let cartItems;
let categories = JSON.parse(localStorage.getItem("categories"));
let products = JSON.parse(localStorage.getItem("products"));
let categoryProducts = products;
let currentPage = 1;
let itemsPerPage = 6;
let start = 0;
let end = itemsPerPage;
let totalPages= Math.ceil(products.length/itemsPerPage);


// =================================================== //
// -------------------- First Load ------------------- //
// =================================================== //

window.addEventListener('DOMContentLoaded', () => {
renderPagesList(totalPages,products);
detailSection();
renderCategory();
changeCategory();
addToCart();
renderCart();
})


// =================================================== //
// ------------------- renderPage -------------------- //
// =================================================== //



function renderPagesList(total,productList) {
    if(total!=0){
    let str = '';
    for(let i=1; i<=total; i++) {
        str+= `
            <a href="#header-2">
                <li class="page-item">${i}</li>
            </a>
        `;
    }
    document.querySelector(".page-list").innerHTML=str;
    changePage(productList);
    changePageActive();
}
else{
    document.querySelector(".page-list").innerHTML="";
}
    renderProduct(productList,start,end);
}


function changePageActive() {
    const pagesList = document.querySelectorAll('.page-list a');
    pagesList[0].children[0].classList.add("page-item-active");
    Array.from(pagesList).forEach((item) => {
        item.addEventListener("click", () => {
            pagesList.forEach((i) => i.children[0].classList.remove("page-item-active"))
            item.children[0].classList.add("page-item-active");
        })
    })
}

function changePage(productList) {
    const pagesList = document.querySelectorAll(".page-list a");
    pagesList.forEach(function (item, index) {
        item.addEventListener("click", (event) => {
            let value = index+1;
            currentPage = value
            s = (currentPage-1)*itemsPerPage;
            e = currentPage*itemsPerPage;
            renderProduct(productList, s, e);
        })
    })
}

// =================================================== //
// ----------------- renderProduct ------------------- //
// =================================================== //


function renderProduct(productList, s, e) {
    const product_row = document.querySelector(".product-list");
    product_row.innerHTML='';
    productList.forEach(function (item, index) {
        if(index>=s && index <e) {
            const product = document.createElement("div");
            product.classList.add("item-display"); // modifiy here
            product.innerHTML = ` 
                    <div href="#" class="item-link">
                        <div class="item js-item" data-id="${item.id}">
                            <div class="item-img" style="background-image:url(${item.background_image}) ;" ></div>
                            <div class="item-name">${item.name}</div>
                            <div class="item-price">${item.price}</div>
                            <div class="item-option">
                                <div class="item-add-btn item-btn"><i class="fa-solid fa-cart-shopping"></i></div>
                                <div class="item-detail-btn js-detail item-btn"><i class="fa-solid fa-magnifying-glass"></i></div>
                            </div>
                        </div>
                    </div>
            `;
            product_row.appendChild(product);
            const productItemLinks = document.querySelectorAll(".item-link");
            productItemLinks.forEach(function(item) {
                item.onclick = function(e) {e.preventDefault()}
            })
        }
    })
}


// =================================================== //
// -------------- renderProductDetail ---------------- //
// =================================================== //


function detailSection(){
const detailBtns = document.querySelectorAll(".js-detail");
const detailForm = document.querySelector(".js-detail-form")
const addToCartBtns = document.querySelectorAll(".item-add-btn");
    detailBtns.forEach(function(item) {
    item.onclick = function () {
        const productBox = getParentElement(item, ".js-item");
        const productID = productBox.getAttribute("data-id");
        const productItem = products.find(function(i) {return i.id === productID});
        const detailInfo = document.querySelector(".detail-info");
        detailInfo.setAttribute("data-id",`${productID}`);
        detailInfo.set
        detailInfo.innerHTML= `
                    <div class="col two-col item-img detail-img" style="background-image:url(${productItem.background_image}) ;"></div>
                    <div class="col two-col item-detail">
                        <div class="detail-name">${productItem.name}</div>
                        <div class="detail-price">${productItem.price}</div>
                        <div class="detail-description"><p>${productItem.description}</p></div>
                        <div class="detail-quantity">Còn lại:${productItem.quantity}</div>
                        <div class="item-add-btn item-btn"><i class="fa-solid fa-cart-shopping">Mua ngay</i></div>
                    </div>
                    <div class="clear"></div>
        `
        detailForm.classList.add('open');
        renderCart();
    }
    })
}










// =================================================== //
// --------------------- category -------------------- //
// =================================================== //

function renderCategory(){
    const categoryRow = document.querySelector(".category-list");
    categoryRow.innerHTML='';
    categories.forEach(function(item){
        const category = document.createElement("li");
        category.classList.add("category-item");
        category.innerHTML = `
        <a href="#" class="category-link" data-cateid =${item.categoryID}><img src=${item.categoryImg} alt="" ></a>
        `
        ;
        categoryRow.appendChild(category);
    })
}
 function changeCategory(){
    const categoriesLink = document.querySelectorAll(".category-link");
    categoriesLink.forEach(function(item,index){
        item.addEventListener("click",function(e){
            e.preventDefault(); 
            const categoryID = item.getAttribute("data-cateid");
            categoryProducts = products.filter(function(i) {return i.categoryID === categoryID})
            totalPages = Math.ceil(categoryProducts.length/itemsPerPage);
            renderPagesList(totalPages,categoryProducts);
            renderCart();
    })
})

 }

// =================================================== //
// --------------------- searching-------------------- //
// =================================================== //


const searchInput = document.querySelector(".nav-input");
const searchBtn = document.querySelector(".search-btn");

searchBtn.addEventListener("click",function(e) {
    e.preventDefault();
    let searchValue = searchInput.value.toLowerCase();
    let searchedProducts = categoryProducts.filter(function(item){
        return item.name.toLowerCase().includes(searchValue);
    })
    // if(searchedProducts.length!==0){
    console.log(searchedProducts);
    totalPages= Math.ceil(searchedProducts.length/itemsPerPage);
    renderPagesList(totalPages,searchedProducts);
    renderCart();
   
    // }
    // else{
    //     renderPagesList(1,searchedProducts);
    // }
})










// =================================================== //
// -------------------- cart-box --------------------- //
// =================================================== //



const cartBtn = document.querySelector(".cart-btn");
const cartBox = document.querySelector(".cart-box");
cartBtn.onclick = function() {
    cartBox.classList.toggle("cart-box-hide");}







// =================================================== //
// ------------------ cart-section ------------------- //
// =================================================== //

function renderCart() {
    cartItems = localStorage.getItem("cartItems") ? JSON.parse(localStorage.getItem("cartItems")) : [];
    const cartList = document.querySelector(".cart-list");
    cartList.innerHTML='';
    if(cartItems.length !==0) {
        cartItems.forEach(function(item) {
            const cartItem = document.createElement("div");
            cartItem.classList.add("cart-item");
            cartItem.setAttribute("data-id",`${item.id}`);
            cartItem.innerHTML = `
            <div class="cart-item-img" style="background-image:url(${item.img}) ;"></div>
                                <div class="cart-item-detail">
                                    <div class="cart-item-info">
                                        <div class="cart-item-name">${item.name}</div>
                                        <div class="cart-item-price">${item.price}đ</div>
                                    </div>
                                    <div class="cart-item-quantity">
                                        <i class="fa-solid fa-chevron-up incr-btn"></i>
                                        <span>${item.quantity}</span>
                                        <i class="fa-solid fa-chevron-down decr-btn"></i>
                                    </div>
                                    <div class="cart-total">${item.totalPrice}đ</div>
                                    <i class="fa-solid fa-trash-can remove-btn"></i>
                                </div>
            `;
            cartList.appendChild(cartItem);            
        })
        document.querySelector(".cart-nofication").innerHTML = `<div class="cart-confirm-btn">Xác nhận đặt hàng</div>`;
        buyConfirm();
        addToCart();
        removeFromCart(cartList);
        increaseQuantity();
        decreaseQuantity();
    } else {
        document.querySelector(".cart-nofication").innerText = "Giỏ hàng hiện tại đang trống";
    }

}





function addToCart() {
    // id, name, price, quantity ,background_image, categoryID, description
    cartItems = localStorage.getItem("cartItems") ? JSON.parse(localStorage.getItem("cartItems")) : [];
    const addToCartBtns = document.querySelectorAll(".item-add-btn");
    addToCartBtns.forEach(function(item) {
        item.onclick = function () {
            console.log(addToCartBtns);
            const productBox = getParentElement(item, ".js-item");
            const productID = productBox.getAttribute("data-id");
            const productItem = products.find(function(i) {return i.id === productID});
            if(productItem.quantity <= 0) {
                alert("Out of order!")
            }
            else {
                const index = cartItems.findIndex(function(i) {return i.id === productID})    // return index, if not find return -1.
                if (index !== -1) {
                    if(productItem.quantity<cartItems[index].quantity+1) {
                        alert("Out of order!")
                    }
                    else {
                        cartItems[index].quantity +=1;
                        cartItems[index].totalPrice = cartItems[index].quantity*cartItems[index].price;
                        localStorage.setItem("cartItems", JSON.stringify(cartItems));
                    }
                }
                else {
                    let cartItem = new cart_product(productID, productItem.background_image, productItem.name, parseInt(productItem.price.replace(/[ .đ]/gm,'')), 1);
                    cartItems.push(cartItem);
                    localStorage.setItem("cartItems", JSON.stringify(cartItems));
                }
                renderCart();
            }
        }
    })
}


function removeFromCart() {
    const removeBtns = document.querySelectorAll(".remove-btn");
    removeBtns.forEach(function(item){
        item.onclick = function () {
            const cartItem = getParentElement(item,".cart-item");
            const itemID = cartItem.getAttribute("data-id");
            const index = cartItems.findIndex(function(i){ return i.id === itemID});
            cartItems.splice(index,1);
            localStorage.setItem("cartItems", JSON.stringify(cartItems));
            document.querySelector(".cart-list").removeChild(cartItem);
            if(cartItems.length === 0){
                document.querySelector(".cart-nofication").innerText = "Giỏ hàng hiện tại đang trống";
            }
        }
    })
}







function decreaseQuantity() {
    const increaseBtns = document.querySelectorAll(".decr-btn");
    increaseBtns.forEach(function(item) {
        item.onclick = function(){
            const cartItem = getParentElement(item,".cart-item");
            const itemID = cartItem.getAttribute("data-id");
            const index = cartItems.findIndex(function(i) {return i.id === itemID })
            if(cartItems[index].quantity>0){
                cartItems[index].quantity -= 1;
                cartItems[index].totalPrice=cartItems[index].quantity * cartItems[index].price;
            }
            else {
                cartItems[index].quantity=0;
                cartItems[index].totalPrice=0;
            }
            item.parentElement.children[1].innerText = cartItems[index].quantity;
            cartItem.children[1].children[2].innerText= cartItems[index].totalPrice+"đ";
            localStorage.setItem("cartItems", JSON.stringify(cartItems));
        }
    })
}
function increaseQuantity() {
    const decreaseBtns = document.querySelectorAll(".incr-btn");
        decreaseBtns.forEach(function(item){
            item.onclick = function() {
                const cartItem = getParentElement(item,".cart-item");
                const itemID = cartItem.getAttribute("data-id");
                const index = cartItems.findIndex(function(i) {return i.id === itemID });
                const itemQuantity = products.find(function(i) {return i.id === itemID}).quantity;
                if(cartItems[index].quantity+1> itemQuantity){
                    alert("sản phẩm hết hàng");
                }
                else {
                    cartItems[index].quantity+=1;
                    cartItems[index].totalPrice= cartItems[index].quantity*cartItems[index].price;
                }
                item.parentElement.children[1].innerText = cartItems[index].quantity;
                cartItem.children[1].children[2].innerText= cartItems[index].totalPrice+"đ";
                localStorage.setItem("cartItems", JSON.stringify(cartItems));
            }
        })


}

// =================================================== //
// ------------------ Buy-Sections ------------------- //
// =================================================== //
const Name = document.querySelector("#customername");
const phone = document.querySelector("#phoneNumber");
function buyConfirm() {
    const buyBtn = document.querySelector(".cart-confirm-btn");
        buyBtn.addEventListener("click",function (){
            if(loginId == -1){
                openForm(loginForm)
            }else {
                Name.value="";
                phone.value="";
                document.querySelector(".js-buy-form").classList.add("open");
                buyList = document.querySelector(".buy-list");
                buyTotal = document.querySelector(".buy-total");
                buyList.innerHTML =``;
                let total = 0;
                cartItems.forEach(function(item) {
                    total+= item.totalPrice;
                    let buyItem = document.createElement("div");
                    buyItem.classList.add("buy-item");
                    buyItem.setAttribute("data-id", `${item.id}`);
                    buyItem.innerHTML = `
                    <div class="item-img" style="background-image:url(${item.img})"></div>
                                <div class="item-detail">
                                    <div class="item-info">
                                        <div class="item-name">${item.name}</div>
                                        <div class="item-price">${item.price}đ</div>
                                    </div>
                                    <div class="item-quantity">${item.quantity}</div>
                                    <div class="item-total">${item.totalPrice}đ</div>
                                    
                                </div>
                    `
                    buyList.appendChild(buyItem);
                })
                buyTotal.innerHTML = `Tổng tiền: <span style="color:red;">${total} đ</span>`;
                buyConfirmSubmit(total);
            }
        })
}

function buyConfirmSubmit(total) {
    const buySubmit = document.querySelector(".js-buy-confirm-btn");
    console.log(buySubmit);
    buySubmit.addEventListener("click",function(e){
        e.preventDefault();
        let orderNote = {
            orderNoteID: orderList.length,
            status: "Chưa xử lý",
            userID: loginId,
            customerName: Name.value,
            phoneNumber: phone.value,
            date: new Date().toLocaleString(),
            buyItems: cartItems,
            totalPrice:total
            }   
        orderList.push(orderNote);
        localStorage.setItem("orderList", JSON.stringify(orderList));
        const buyProducts = document.querySelectorAll(".buy-item");
        buyProducts.forEach(function(item) {
            const productID  = item.getAttribute("data-id");
            const index = products.findIndex(function(i) {return i.id === productID});
            const index2 = cartItems.findIndex((i) => {return i.id === productID})
            products[index].quantity -= cartItems[index2].quantity;
        })
        alert("Mua hàng thành công");
        cartItems = [];
        localStorage.setItem("cartItems", JSON.stringify(cartItems));
        renderCart();
        localStorage.setItem("products", JSON.stringify(products));
        document.querySelector(".js-buy-form").classList.remove("open");
})
}
 const orderListBtns = document.querySelectorAll(".js-orderlist-btn");
 const orderListForm = document.querySelector(".js-orderlist-form");
 for(const orderListBtn of orderListBtns){
    orderListBtn.addEventListener("click",function(e){
        e.preventDefault();
        orderListForm.classList.add("open");
        const orderListBody = document.querySelector(".order-list");
        const orderNotes = orderList.filter((item) => {
            return item.userID === loginId; 
        })
        if(orderNotes.length == 0) {
            orderListBody.innerHTML = `<span style="margin-top: 50px; display:block">Bạn chưa có đơn hàng nào, hãy mua ngay tại shop chúng tôi!</span>`
        }
        else {
            orderListBody.innerHTML = "";
        }
        orderNotes.forEach(function(item) {
            const orderNote = document.createElement("div");
            const orderDetail = document.createElement("div");
            orderDetail.classList.add("order-detail","hide");
            orderNote.classList.add("order");
            orderNote.innerHTML = `
            <div class="order-info">
                        <div class="order-id">mã đơn hàng: <span>${item.orderNoteID}</span></div>
                        <div class="order-price">thành tiền: <span>${item.totalPrice}đ</span></div>
                    </div>
                    <div class="order-date">Ngày tạo: ${item.date}</div>
                    <div class="order-status">Tình trạng: ${item.status} </div>
                    <div class="order-detail-btn">Xem chi tiết <i class="fa-solid fa-plus"></i></div>
                </div>
            `
            let str="";
            item.buyItems.forEach(function(item){
                str+= `
                    <div class="order-item">
                        <div class="order-product-name">${item.name}</div>
                        <div class="order-product-price">${item.price}đ</div>
                        <div class="order-product-quantity">${item.quantity}</div>
                    </div>
                `
            })
            orderDetail.innerHTML = str;
            orderListBody.append(orderNote,orderDetail);
        })
        document.querySelectorAll(".order-detail-btn").forEach(function(item){
            const orderNoteDetail= getParentElement(item,".order").nextElementSibling; 
            item.onclick = function() {
                if(orderNoteDetail.classList.contains("hide")){
                    item.innerHTML=`
                    ẩn bớt <i class="fa-solid fa-minus"></i>
                `
                }else  {
                    item.innerHTML= `
                    Xem chi tiết <i class="fa-solid fa-plus"></i>
                    `
                }
                orderNoteDetail.classList.toggle("hide");
            }
        })
    })
}




// =================================================== //
// ------------------ extend-method------------------- //
// =================================================== //


const cartContainer = document.querySelector(".cart-box");
cartContainer.onclick = function(e){
    e.stopPropagation();
}

function getParentElement(element, parent) {
    while(element.parentElement) {
        if(element.parentElement.matches(parent)) {
            return element.parentElement;
        }
        element = element.parentElement;
    }
}

const reloadBtns = document.querySelectorAll(".js-reload");
for(const reloadBtn of reloadBtns){
reloadBtn.onclick = function () {
    window.location.reload();
}}